import"../chunks/DsnmJJEf.js";import{M as ct,R as je,T as ut,H as p,N as Z,o as c,O as dt,D as m,C as e,W as ne,P as s,I as a,V as r,J as t,u as d,Q as M,b5 as At,U as Te,b6 as We,aD as Ze,ac as mt,n as Ge,ba as oa,b0 as ia,m as rt,$ as Xt,b9 as qt,bb as Zt,av as it,aw as Vt,aC as Ae,a9 as wt,z as la,aB as ca}from"../chunks/J53a5pXB.js";import{p as y,i as F,a as ea,b as Pt}from"../chunks/CVWE5XDX.js";import"../chunks/B6xteeIL.js";import{a as da,s as st}from"../chunks/CORCjSxP.js";import{s as Ve,c as Dt,e as et,d as zt,b as $t,i as ot,r as pt,t as va}from"../chunks/DwDLloZq.js";import{i as gt}from"../chunks/Ce3FM-Or.js";import{S as Ot,A as Ue,a as ua,F as ga,b as Rt,T as ta,D as aa,c as Ht}from"../chunks/BJbLsdG9.js";import{b as St,c as Ut,a as fa}from"../chunks/k9KbQBG2.js";import{C as Wt}from"../chunks/NJjUsxgD.js";import{p as ha,P as na}from"../chunks/DxdlsFuA.js";import{g as sa}from"../chunks/qLTqb0RQ.js";import{X as Bt}from"../chunks/D9OV0qr6.js";import{b as Qt}from"../chunks/CNdUi1S-.js";import{a as lt,b as Ft,c as Kt}from"../chunks/CDx50ljX.js";var ma=p('<span slot="default" class="transaction-count-label svelte-q0idq7"> </span>'),pa=p('<div class="expense-segment svelte-q0idq7"></div>'),_a=p('<div class="breakdown-item svelte-q0idq7"><div class="item-indicator svelte-q0idq7"><div class="color-dot svelte-q0idq7"></div> <span class="item-icon svelte-q0idq7"> </span></div> <div class="item-details svelte-q0idq7"><span class="item-label svelte-q0idq7"> </span> <span class="item-amount svelte-q0idq7"> </span></div> <div class="item-percentage svelte-q0idq7"> </div></div>'),ba=p('<div class="expense-breakdown svelte-q0idq7"><h3 class="breakdown-title svelte-q0idq7">Desglose de gastos</h3> <div class="expense-bar svelte-q0idq7"></div> <div class="breakdown-items svelte-q0idq7"></div></div>'),ya=p('<div class="header-extra svelte-q0idq7"><!></div>'),wa=p('<header><div class="header-content svelte-q0idq7"><div class="header-title svelte-q0idq7"><h1 class="page-title svelte-q0idq7">Transacciones</h1> <p class="period-subtitle svelte-q0idq7"> </p></div> <div class="stats-grid svelte-q0idq7"><!> <!> <!> <!></div> <!> <!></div></header>');function xa(we,i){const u=da(i);ct(i,!1);const I=ne(),W=ne(),w=ne();let l=y(i,"stats",8),h=y(i,"currency",8,"EUR"),Y=y(i,"period",8,"mes actual"),C=y(i,"loading",8,!1),S=y(i,"showBreakdown",8,!0);const q=[{key:"essential",label:"Esenciales",color:"#FECD2C",icon:"🏠"},{key:"discretionary",label:"Discrecionales",color:"#F5796C",icon:"🎯"},{key:"investment",label:"Inversiones",color:"#7ABAA5",icon:"📈"},{key:"debt_payment",label:"Deudas",color:"#F5796C",icon:"💳"},{key:"no_compute",label:"No computar",color:"#94A3B8",icon:"🚫"}];je(()=>m(l()),()=>{r(I,Object.values(l().expenseBreakdown).reduce((Q,se)=>Q+se,0))}),je(()=>(m(l()),e(I)),()=>{r(W,q.map(Q=>{const se=l().expenseBreakdown[Q.key],g=e(I)>0?se/e(I)*100:0;return{...Q,amount:se,percentage:g}}).filter(Q=>Q.amount>0))}),je(()=>m(C()),()=>{r(w,["transaction-header",C()&&"loading"].filter(Boolean).join(" "))}),ut(),gt();var fe=wa(),ee=a(fe),$=a(ee),K=s(a($),2),k=a(K,!0);t(K),t($);var ie=s($,2),Ie=a(ie);Ot(Ie,{label:"Balance",get value(){return m(l()),d(()=>l().balance)},get currency(){return h()},variant:"balance",get loading(){return C()}});var T=s(Ie,2);Ot(T,{label:"Ingresos",get value(){return m(l()),d(()=>l().income)},get currency(){return h()},variant:"income",get loading(){return C()}});var te=s(T,2);Ot(te,{label:"Gastos",get value(){return m(l()),d(()=>l().expenses)},get currency(){return h()},variant:"expense",get loading(){return C()}});var be=s(te,2);Ot(be,{label:"Transacciones",get value(){return m(l()),d(()=>l().transactionCount)},currency:"",get loading(){return C()},children:(Q,se)=>{var g=ma(),O=a(g,!0);t(g),Z(()=>M(O,(m(l()),d(()=>l().transactionCount===1?"transacción":"transacciones")))),c(Q,g)},$$slots:{default:!0}}),t(ie);var $e=s(ie,2);{var qe=Q=>{var se=ba(),g=s(a(se),2);et(g,5,()=>e(W),ot,(o,_)=>{var G=pa();Z((R,ye)=>{zt(G,`background-color: ${e(_),d(()=>e(_).color)??""}; width: ${e(_),d(()=>e(_).percentage)??""}%;`),$t(G,"title",`${e(_),d(()=>e(_).label)??""}: ${R??""} (${ye??""}%)`)},[()=>(m(h()),e(_),d(()=>new Intl.NumberFormat("es-ES",{style:"currency",currency:h()}).format(e(_).amount))),()=>(e(_),d(()=>e(_).percentage.toFixed(1)))]),c(o,G)}),t(g);var O=s(g,2);et(O,5,()=>e(W),ot,(o,_)=>{var G=_a(),R=a(G),ye=a(R),xe=s(ye,2),E=a(xe,!0);t(xe),t(R);var V=s(R,2),B=a(V),D=a(B,!0);t(B);var de=s(B,2),De=a(de,!0);t(de),t(V);var ve=s(V,2),pe=a(ve);t(ve),t(G),Z((H,f)=>{zt(ye,`background-color: ${e(_),d(()=>e(_).color)??""};`),M(E,(e(_),d(()=>e(_).icon))),M(D,(e(_),d(()=>e(_).label))),M(De,H),M(pe,`${f??""}%`)},[()=>(m(h()),e(_),d(()=>new Intl.NumberFormat("es-ES",{style:"currency",currency:h()}).format(e(_).amount))),()=>(e(_),d(()=>e(_).percentage.toFixed(1)))]),c(o,G)}),t(O),t(se),c(Q,se)};F($e,Q=>{S()&&!C()&&e(I)>0&&Q(qe)})}var Fe=s($e,2);{var z=Q=>{var se=ya(),g=a(se);st(g,i,"default",{},null),t(se),c(Q,se)};F(Fe,Q=>{d(()=>u.default)&&Q(z)})}t(ee),t(fe),Z(()=>{Ve(fe,1,Dt(e(w)),"svelte-q0idq7"),M(k,Y())}),c(we,fe),dt()}var ka=p('<span class="today-indicator svelte-i131g2">•</span>'),Ca=p('<div><div class="navigation svelte-i131g2"><!> <div class="date-display-container svelte-i131g2"><button class="date-button svelte-i131g2" title="Ir a hoy"><span class="date-text svelte-i131g2"> </span> <!></button></div> <!></div> <!></div>');function Sa(we,i){ct(i,!1);const u=ne(),I=ne(),W=ne();let w=y(i,"dateRange",12),l=y(i,"mode",12,"month"),h=y(i,"showModeToggle",8,!0),Y=y(i,"allowNavigation",8,!0),C=y(i,"size",8,"md");const S=At(),q={day:{label:"Día",format:"long"},week:{label:"Semana",format:"medium"},month:{label:"Mes",format:"medium"},year:{label:"Año",format:"medium"}};function fe(){if(!Y())return;const o={...w()};switch(l()){case"day":o.start.setDate(o.start.getDate()-1),o.end.setDate(o.end.getDate()-1);break;case"week":o.start.setDate(o.start.getDate()-7),o.end.setDate(o.end.getDate()-7);break;case"month":o.start.setMonth(o.start.getMonth()-1),o.end.setMonth(o.end.getMonth()-1);break;case"year":o.start.setFullYear(o.start.getFullYear()-1),o.end.setFullYear(o.end.getFullYear()-1);break}w(o),S("change",{dateRange:w(),mode:l()})}function ee(){if(!Y())return;const o={...w()};switch(l()){case"day":o.start.setDate(o.start.getDate()+1),o.end.setDate(o.end.getDate()+1);break;case"week":o.start.setDate(o.start.getDate()+7),o.end.setDate(o.end.getDate()+7);break;case"month":o.start.setMonth(o.start.getMonth()+1),o.end.setMonth(o.end.getMonth()+1);break;case"year":o.start.setFullYear(o.start.getFullYear()+1),o.end.setFullYear(o.end.getFullYear()+1);break}w(o),S("change",{dateRange:w(),mode:l()})}function $(){const o=new Date,_={start:new Date(o),end:new Date(o)};switch(l()){case"day":break;case"week":const G=o.getDay(),R=new Date(o);R.setDate(o.getDate()-G+(G===0?-6:1)),_.start=R,_.end=new Date(R),_.end.setDate(R.getDate()+6);break;case"month":_.start=new Date(o.getFullYear(),o.getMonth(),1),_.end=new Date(o.getFullYear(),o.getMonth()+1,0);break;case"year":_.start=new Date(o.getFullYear(),0,1),_.end=new Date(o.getFullYear(),11,31);break}w(_),S("change",{dateRange:w(),mode:l()})}function K(){const o=["day","week","month","year"],G=(o.indexOf(l())+1)%o.length;l(o[G]),$(),S("modeChange",{mode:l()})}je(()=>(m(l()),m(w())),()=>{r(u,(()=>{const o=new Date,_=o.toDateString();switch(l()){case"day":return w().start.toDateString()===_;case"week":return w().start<=o&&o<=w().end;case"month":return w().start.getMonth()===o.getMonth()&&w().start.getFullYear()===o.getFullYear();case"year":return w().start.getFullYear()===o.getFullYear();default:return!1}})())}),je(()=>(m(C()),m(Y())),()=>{r(I,["date-range-selector",`size-${C()}`,!Y()&&"no-navigation"].filter(Boolean).join(" "))}),je(()=>(m(l()),m(w())),()=>{r(W,l()==="week"?`${w().start.toLocaleDateString("es-ES",{day:"numeric",month:"short"})} - ${w().end.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}`:l()==="month"?w().start.toLocaleDateString("es-ES",{month:"long",year:"numeric"}):l()==="year"?w().start.getFullYear().toString():w().start.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"}))}),ut(),gt();var k=Ca(),ie=a(k),Ie=a(ie);{var T=o=>{Ue(o,{variant:"ghost",get size(){return C()},icon:"‹","aria-label":"Período anterior",$$events:{click:fe}})};F(Ie,o=>{Y()&&o(T)})}var te=s(Ie,2),be=a(te),$e=a(be),qe=a($e,!0);t($e);var Fe=s($e,2);{var z=o=>{var _=ka();c(o,_)};F(Fe,o=>{e(u)&&o(z)})}t(be),t(te);var Q=s(te,2);{var se=o=>{Ue(o,{variant:"ghost",get size(){return C()},icon:"›","aria-label":"Período siguiente",$$events:{click:ee}})};F(Q,o=>{Y()&&o(se)})}t(ie);var g=s(ie,2);{var O=o=>{Ue(o,{variant:"outline",get size(){return C()},title:"Cambiar vista de período",$$events:{click:K},children:(_,G)=>{We();var R=Ze();Z(()=>M(R,(m(l()),d(()=>q[l()].label)))),c(_,R)},$$slots:{default:!0}})};F(g,o=>{h()&&o(O)})}t(k),Z(()=>{Ve(k,1,Dt(e(I)),"svelte-i131g2"),be.disabled=e(u),M(qe,e(W))}),Te("click",be,$),c(we,k),dt()}var Da=p("<!> <!> <!>",1),Ta=p('<div class="selection-toolbar svelte-7x9x2z"><div class="selection-info svelte-7x9x2z"><span class="selection-count svelte-7x9x2z"> </span></div> <div class="selection-actions svelte-7x9x2z"><!> <!> <!></div></div>'),Ma=p('<div class="normal-toolbar svelte-7x9x2z"><div class="toolbar-left svelte-7x9x2z"><!> <!></div> <div class="toolbar-right svelte-7x9x2z"><!> <!> <!></div></div>'),Fa=p('<div class="filter-panel svelte-7x9x2z"><!> <!></div>'),$a=p('<span class="filter-tag search-tag svelte-7x9x2z"> <button class="remove-tag svelte-7x9x2z" aria-label="Limpiar búsqueda">×</button></span>'),za=p('<span class="tag-count svelte-7x9x2z"> </span>'),Aa=p('<span class="filter-tag svelte-7x9x2z"> <!></span>'),Ia=p('<button class="clear-all-filters svelte-7x9x2z">Limpiar filtros</button>'),Ea=p('<div class="active-filters-summary svelte-7x9x2z"><div class="summary-content svelte-7x9x2z"><!> <!> <!></div></div>'),ja=p('<div><div class="toolbar-main svelte-7x9x2z"><!></div> <!> <!></div>');function qa(we,i){ct(i,!1);const u=ne(),I=ne(),W=ne();let w=y(i,"searchValue",12,""),l=y(i,"dateRange",12),h=y(i,"dateMode",12,"month"),Y=y(i,"filters",24,()=>[]),C=y(i,"selectedCount",8,0),S=y(i,"totalCount",8,0),q=y(i,"showFilters",12,!1),fe=y(i,"selectionMode",8,!1),ee=y(i,"loading",8,!1);const $=At();function K({detail:E}){w(E.value),$("search",{value:E.value})}function k(){w(""),$("search",{value:""})}function ie({detail:E}){l(E.dateRange),E.mode!==h()&&(h(E.mode),$("dateModeChange",{mode:E.mode})),$("dateRangeChange",{dateRange:E.dateRange})}function Ie({detail:E}){$("filterChange",E)}function T(){$("filterClear")}function te(){q(!q()),$("toggleFilters",{show:q()})}function be(){$("selectAll")}function $e(){$("deselectAll")}function qe(){$("exitSelection")}function Fe(){$("export")}function z(){$("bulkCategorize")}function Q(){$("bulkDelete")}je(()=>m(Y()),()=>{r(u,Y().some(E=>E.active))}),je(()=>m(w()),()=>{r(I,w().trim().length>0)}),je(()=>(m(fe()),m(q())),()=>{r(W,["transaction-toolbar",fe()&&"selection-mode",q()&&"filters-expanded"].filter(Boolean).join(" "))}),ut(),gt();var se=ja(),g=a(se),O=a(g);{var o=E=>{var V=Ta(),B=a(V),D=a(B),de=a(D);t(D),t(B);var De=s(B,2),ve=a(De);{var pe=ue=>{Ue(ue,{variant:"outline",size:"sm",$$events:{click:be},children:(J,ke)=>{We();var x=Ze("Seleccionar todas");c(J,x)},$$slots:{default:!0}})};F(ve,ue=>{C()<S()&&ue(pe)})}var H=s(ve,2);{var f=ue=>{var J=Da(),ke=Ge(J);Ue(ke,{variant:"outline",size:"sm",$$events:{click:$e},children:(A,U)=>{We();var re=Ze("Deseleccionar");c(A,re)},$$slots:{default:!0}});var x=s(ke,2);Ue(x,{variant:"primary",size:"sm",$$events:{click:z},children:(A,U)=>{We();var re=Ze("Categorizar");c(A,re)},$$slots:{default:!0}});var j=s(x,2);Ue(j,{variant:"outline",size:"sm",$$events:{click:Q},children:(A,U)=>{We();var re=Ze("Eliminar");c(A,re)},$$slots:{default:!0}}),c(ue,J)};F(H,ue=>{C()>0&&ue(f)})}var P=s(H,2);Ue(P,{variant:"ghost",size:"sm",icon:"×","aria-label":"Salir del modo selección",$$events:{click:qe}}),t(De),t(V),Z(()=>M(de,`${C()??""} de ${S()??""} seleccionadas`)),c(E,V)},_=E=>{var V=Ma(),B=a(V),D=a(B);Sa(D,{get dateRange(){return l()},get mode(){return h()},$$events:{change:ie,modeChange:ie}});var de=s(D,2);ua(de,{get value(){return w()},placeholder:"Buscar transacciones...",get loading(){return ee()},$$events:{input:K,clear:k}}),t(B);var De=s(B,2),ve=a(De);{let f=mt(()=>(e(u),m(Y()),d(()=>e(u)?Y().filter(P=>P.active).length:void 0)));Ue(ve,{variant:"outline",icon:"🔽",get count(){return e(f)},$$events:{click:te},children:(P,ue)=>{We();var J=Ze("Filtros");c(P,J)},$$slots:{default:!0}})}var pe=s(ve,2);Ue(pe,{variant:"outline",icon:"📥",$$events:{click:Fe},children:(f,P)=>{We();var ue=Ze("Exportar");c(f,ue)},$$slots:{default:!0}});var H=s(pe,2);st(H,i,"actions",{},null),t(De),t(V),c(E,V)};F(O,E=>{fe()?E(o):E(_,!1)})}t(g);var G=s(g,2);{var R=E=>{var V=Fa(),B=a(V);ga(B,{get filters(){return Y()},title:"Filtros",allowClear:!0,$$events:{change:Ie,clear:T}});var D=s(B,2);st(D,i,"extraFilters",{},null),t(V),c(E,V)};F(G,E=>{q()&&!fe()&&E(R)})}var ye=s(G,2);{var xe=E=>{var V=Ea(),B=a(V),D=a(B);{var de=H=>{var f=$a(),P=a(f),ue=s(P);t(f),Z(()=>M(P,`🔍 "${w()??""}" `)),Te("click",ue,k),c(H,f)};F(D,H=>{e(I)&&H(de)})}var De=s(D,2);et(De,1,()=>(m(Y()),d(()=>Y().filter(H=>H.active))),ot,(H,f)=>{var P=Aa(),ue=a(P),J=s(ue);{var ke=x=>{var j=za(),A=a(j);t(j),Z(()=>M(A,`(${e(f),d(()=>e(f).count)??""})`)),c(x,j)};F(J,x=>{e(f),d(()=>e(f).count!==void 0)&&x(ke)})}t(P),Z(()=>M(ue,`${e(f),d(()=>e(f).label)??""} `)),c(H,P)});var ve=s(De,2);{var pe=H=>{var f=Ia();Te("click",f,T),c(H,f)};F(ve,H=>{e(u)&&H(pe)})}t(B),t(V),c(E,V)};F(ye,E=>{(e(u)||e(I))&&!fe()&&!q()&&E(xe)})}t(se),Z(()=>Ve(se,1,Dt(e(W)),"svelte-7x9x2z")),c(we,se),dt()}var Oa=p('<div class="selection-area svelte-sfuhvk"><!></div>'),Pa=p('<p class="description svelte-sfuhvk"> </p>'),Ra=p('<button class="category-badge svelte-sfuhvk"><span class="category-icon svelte-sfuhvk"> </span> <span class="category-name svelte-sfuhvk"> </span></button>'),Ba=p('<button class="category-badge uncategorized svelte-sfuhvk"><span class="category-icon svelte-sfuhvk">🏷️</span> <span class="category-name svelte-sfuhvk">Sin categoría</span></button>'),La=p('<button class="category-option svelte-sfuhvk"><span class="option-icon svelte-sfuhvk"> </span> <span class="option-name svelte-sfuhvk"> </span></button>'),Na=p('<div class="category-dropdown svelte-sfuhvk"><div class="category-list svelte-sfuhvk"><button class="category-option remove svelte-sfuhvk"><span class="option-icon svelte-sfuhvk">❌</span> <span class="option-name svelte-sfuhvk">Quitar categoría</span></button> <!></div></div>'),Ya=p('<div class="category-area svelte-sfuhvk"><!> <!></div>'),Ga=p('<div class="observations-edit svelte-sfuhvk"><textarea placeholder="Agregar observaciones..." class="observations-input svelte-sfuhvk" rows="2"></textarea> <div class="observations-actions svelte-sfuhvk"><!> <!></div></div>'),Va=p('<button class="edit-observations-btn svelte-sfuhvk" title="Editar observaciones">✏️</button>'),Ha=p('<div class="observations-display svelte-sfuhvk"><p class="observations-text svelte-sfuhvk"> </p> <!></div>'),Ua=p('<button class="add-observations-btn svelte-sfuhvk">+ Agregar observaciones</button>'),Wa=p('<div class="transaction-meta svelte-sfuhvk"><!> <div class="observations-area svelte-sfuhvk"><!></div></div>'),Qa=p('<div class="transaction-actions svelte-sfuhvk"><!></div>'),Ka=p('<div class="dropdown-backdrop svelte-sfuhvk"></div>'),Ja=p('<div><!> <div class="transaction-content svelte-sfuhvk"><div class="transaction-header svelte-sfuhvk"><div class="merchant-info svelte-sfuhvk"><h4 class="merchant-name svelte-sfuhvk"> </h4> <!></div> <div class="amount-area svelte-sfuhvk"><!> <!></div></div> <!></div> <!></div> <!>',1);function Xa(we,i){ct(i,!1);const u=ne(),I=ne(),W=ne(),w=ne();let l=y(i,"transaction",8),h=y(i,"categories",24,()=>[]),Y=y(i,"selected",8,!1),C=y(i,"selectionMode",8,!1),S=y(i,"showActions",8,!0),q=y(i,"showCategory",8,!0),fe=y(i,"showDate",8,!1),ee=y(i,"compact",8,!1);const $=At();let K=ne(!1),k=ne(!1),ie=ne(l().observations||"");function Ie({detail:f}){$("selectionChange",{transactionId:l().id,selected:f.checked})}function T(f){$("categoryChange",{transactionId:l().id,categoryId:f?.id||null}),r(K,!1)}function te(){r(k,!0)}function be(){$("observationsChange",{transactionId:l().id,observations:e(ie).trim()||null}),r(k,!1)}function $e(){r(ie,l().observations||""),r(k,!1)}function qe(f){f.key==="Enter"&&!f.shiftKey?(f.preventDefault(),be()):f.key==="Escape"&&$e()}je(()=>m(l()),()=>{r(u,!!l().category)}),je(()=>m(l()),()=>{r(I,l().amount>0)}),je(()=>m(l()),()=>{r(W,l().category?.color||"#gray")}),je(()=>(m(ee()),m(Y()),m(C())),()=>{r(w,["transaction-card",ee()&&"compact",Y()&&"selected",C()&&"selection-mode"].filter(Boolean).join(" "))}),ut(),gt();var Fe=Ja(),z=Ge(Fe),Q=a(z);{var se=f=>{var P=Oa(),ue=a(P);ta(ue,{get checked(){return Y()},$$events:{change:Ie}}),t(P),c(f,P)};F(Q,f=>{C()&&f(se)})}var g=s(Q,2),O=a(g),o=a(O),_=a(o),G=a(_,!0);t(_);var R=s(_,2);{var ye=f=>{var P=Pa(),ue=a(P,!0);t(P),Z(()=>M(ue,(m(l()),d(()=>l().description)))),c(f,P)};F(R,f=>{m(l()),m(ee()),d(()=>l().description&&!ee())&&f(ye)})}t(o);var xe=s(o,2),E=a(xe);{let f=mt(()=>ee()?"sm":"md");Rt(E,{get amount(){return m(l()),d(()=>l().amount)},get size(){return e(f)}})}var V=s(E,2);{var B=f=>{aa(f,{get date(){return m(l()),d(()=>l().date)},format:"short"})};F(V,f=>{fe()&&f(B)})}t(xe),t(O);var D=s(O,2);{var de=f=>{var P=Wa(),ue=a(P);{var J=U=>{var re=Ya(),Ce=a(re);{var Se=oe=>{var le=Ra(),me=a(le),L=a(me,!0);t(me);var he=s(me,2),Re=a(he,!0);t(he),t(le),Z(()=>{zt(le,`background-color: ${e(W)??""}20; border-color: ${e(W)??""};`),M(L,(m(l()),d(()=>l().category?.icon))),M(Re,(m(l()),d(()=>l().category?.name)))}),Te("click",le,()=>r(K,!e(K))),c(oe,le)},_e=oe=>{var le=Ba();Te("click",le,()=>r(K,!e(K))),c(oe,le)};F(Ce,oe=>{e(u)?oe(Se):oe(_e,!1)})}var X=s(Ce,2);{var ae=oe=>{var le=Na(),me=a(le),L=a(me),he=s(L,2);et(he,1,h,ot,(Re,ze)=>{var Pe=La(),He=a(Pe),Je=a(He,!0);t(He);var Xe=s(He,2),tt=a(Xe,!0);t(Xe),t(Pe),Z(()=>{zt(Pe,`background-color: ${e(ze),d(()=>e(ze).color)??""}10;`),M(Je,(e(ze),d(()=>e(ze).icon))),M(tt,(e(ze),d(()=>e(ze).name)))}),Te("click",Pe,()=>T(e(ze))),c(Re,Pe)}),t(me),t(le),Te("click",L,()=>T(null)),c(oe,le)};F(X,oe=>{e(K)&&oe(ae)})}t(re),c(U,re)};F(ue,U=>{q()&&U(J)})}var ke=s(ue,2),x=a(ke);{var j=U=>{var re=Ga(),Ce=a(re);oa(Ce),ia(Ce,!0);var Se=s(Ce,2),_e=a(Se);Ue(_e,{variant:"primary",size:"sm",$$events:{click:be},children:(ae,oe)=>{We();var le=Ze("Guardar");c(ae,le)},$$slots:{default:!0}});var X=s(_e,2);Ue(X,{variant:"ghost",size:"sm",$$events:{click:$e},children:(ae,oe)=>{We();var le=Ze("Cancelar");c(ae,le)},$$slots:{default:!0}}),t(Se),t(re),St(Ce,()=>e(ie),ae=>r(ie,ae)),Te("keydown",Ce,qe),c(U,re)},A=U=>{var re=rt(),Ce=Ge(re);{var Se=X=>{var ae=Ha(),oe=a(ae),le=a(oe,!0);t(oe);var me=s(oe,2);{var L=he=>{var Re=Va();Te("click",Re,te),c(he,Re)};F(me,he=>{S()&&he(L)})}t(ae),Z(()=>M(le,(m(l()),d(()=>l().observations)))),c(X,ae)},_e=X=>{var ae=rt(),oe=Ge(ae);{var le=me=>{var L=Ua();Te("click",L,te),c(me,L)};F(oe,me=>{S()&&me(le)},!0)}c(X,ae)};F(Ce,X=>{m(l()),d(()=>l().observations)?X(Se):X(_e,!1)},!0)}c(U,re)};F(x,U=>{e(k)?U(j):U(A,!1)})}t(ke),t(P),c(f,P)};F(D,f=>{ee()||f(de)})}t(g);var De=s(g,2);{var ve=f=>{var P=Qa(),ue=a(P);st(ue,i,"actions",{},null),t(P),c(f,P)};F(De,f=>{S()&&!ee()&&f(ve)})}t(z);var pe=s(z,2);{var H=f=>{var P=Ka();Te("click",P,()=>r(K,!1)),c(f,P)};F(pe,f=>{e(K)&&f(H)})}Z(()=>{Ve(z,1,Dt(e(w)),"svelte-sfuhvk"),M(G,(m(l()),d(()=>l().merchant)))}),c(we,Fe),dt()}var Za=p('<div class="loading-transaction svelte-137e8vm"></div>'),en=p('<div class="loading-group svelte-137e8vm"><div class="loading-header svelte-137e8vm"></div> <div class="loading-transactions svelte-137e8vm"></div></div>'),tn=p('<div class="loading-state svelte-137e8vm"></div>'),an=p('<div class="empty-state svelte-137e8vm"><div class="empty-icon svelte-137e8vm">📝</div> <h3 class="empty-title svelte-137e8vm"> </h3> <p class="empty-message svelte-137e8vm"> </p> <!></div>'),nn=p('<button class="collapse-toggle svelte-137e8vm"><span>▼</span></button>'),sn=p('<div slot="actions" class="transaction-actions svelte-137e8vm"><!></div>'),rn=p('<div class="group-transactions svelte-137e8vm"></div>'),on=p('<div><div class="group-header svelte-137e8vm"><div class="group-date-section svelte-137e8vm"><!> <div class="group-date svelte-137e8vm"><!></div> <div class="transaction-count svelte-137e8vm"> </div></div> <div class="group-actions svelte-137e8vm"><!> <div class="group-totals svelte-137e8vm"><!> <!> <!></div></div></div> <!></div>'),ln=p('<div class="list-summary svelte-137e8vm"><p class="summary-text svelte-137e8vm"> <!></p></div>'),cn=p('<div class="transaction-groups svelte-137e8vm"></div> <!>',1),dn=p("<div><!></div>");function vn(we,i){ct(i,!1);const u=ne(),I=ne();let W=y(i,"groups",24,()=>[]),w=y(i,"categories",24,()=>[]),l=y(i,"selectedTransactions",24,()=>new Set),h=y(i,"selectionMode",8,!1),Y=y(i,"loading",8,!1),C=y(i,"empty",8,!1),S=y(i,"emptyTitle",8,"No hay transacciones"),q=y(i,"emptyMessage",8,"No se encontraron transacciones para los filtros aplicados."),fe=y(i,"collapsible",8,!0),ee=y(i,"currency",8,"EUR");const $=At();let K=new Set;function k(g){fe()&&(K.has(g)?K.delete(g):K.add(g),K=new Set(K))}function ie(g){return K.has(g)}function Ie({detail:g}){$("selectionChange",g)}function T(g,O){$("groupSelection",{transactionIds:g.transactions.map(o=>o.id),selected:O})}function te({detail:g}){$("categoryChange",g)}function be({detail:g}){$("observationsChange",g)}function $e(g,O){$("transactionAction",{action:g,transaction:O})}function qe(g){const O=g.transactions.map(_=>_.id),o=O.filter(_=>l().has(_));return o.length===0?"none":o.length===O.length?"all":"partial"}je(()=>m(W()),()=>{r(u,W().reduce((g,O)=>g+O.transactions.length,0))}),je(()=>(m(Y()),m(h())),()=>{r(I,["transaction-list",Y()&&"loading",h()&&"selection-mode"].filter(Boolean).join(" "))}),ut(),gt();var Fe=dn(),z=a(Fe);{var Q=g=>{var O=tn();et(O,4,()=>Array(3),ot,(o,_)=>{var G=en(),R=s(a(G),2);et(R,4,()=>Array(3),ot,(ye,xe,E,V)=>{var B=Za();c(ye,B)}),t(R),t(G),c(o,G)}),t(O),c(g,O)},se=g=>{var O=rt(),o=Ge(O);{var _=R=>{var ye=an(),xe=s(a(ye),2),E=a(xe,!0);t(xe);var V=s(xe,2),B=a(V,!0);t(V);var D=s(V,2);st(D,i,"emptyActions",{},null),t(ye),Z(()=>{M(E,S()),M(B,q())}),c(R,ye)},G=R=>{var ye=cn(),xe=Ge(ye);et(xe,5,W,B=>B.date,(B,D)=>{const de=mt(()=>(e(D),d(()=>ie(e(D).date)))),De=mt(()=>(e(D),d(()=>qe(e(D)))));var ve=on();let pe;var H=a(ve),f=a(H),P=a(f);{var ue=L=>{var he=nn(),Re=a(he);let ze;t(he),Z(Pe=>{$t(he,"aria-label",e(de)?"Expandir grupo":"Colapsar grupo"),ze=Ve(Re,1,"collapse-icon svelte-137e8vm",null,ze,Pe)},[()=>({collapsed:e(de)})]),Te("click",he,()=>k(e(D).date)),c(L,he)};F(P,L=>{fe()&&L(ue)})}var J=s(P,2),ke=a(J);aa(ke,{get date(){return e(D),d(()=>e(D).date)},format:"relative"}),t(J);var x=s(J,2),j=a(x);t(x),t(f);var A=s(f,2),U=a(A);{var re=L=>{{let he=mt(()=>e(De)==="all"),Re=mt(()=>e(De)==="partial");ta(L,{get checked(){return e(he)},get indeterminate(){return e(Re)},$$events:{change:({detail:ze})=>T(e(D),ze.checked)}})}};F(U,L=>{h()&&L(re)})}var Ce=s(U,2),Se=a(Ce);{var _e=L=>{Rt(L,{get amount(){return e(D),d(()=>e(D).income)},get currency(){return ee()},size:"sm"})};F(Se,L=>{e(D),d(()=>e(D).income>0)&&L(_e)})}var X=s(Se,2);{var ae=L=>{{let he=mt(()=>(e(D),d(()=>-e(D).expenses)));Rt(L,{get amount(){return e(he)},get currency(){return ee()},size:"sm"})}};F(X,L=>{e(D),d(()=>e(D).expenses>0)&&L(ae)})}var oe=s(X,2);Rt(oe,{get amount(){return e(D),d(()=>e(D).total)},get currency(){return ee()},size:"sm"}),t(Ce),t(A),t(H);var le=s(H,2);{var me=L=>{var he=rn();et(he,5,()=>(e(D),d(()=>e(D).transactions)),Re=>Re.id,(Re,ze)=>{{let Pe=mt(()=>(m(l()),e(ze),d(()=>l().has(e(ze).id))));Xa(Re,{get transaction(){return e(ze)},get categories(){return w()},get selected(){return e(Pe)},get selectionMode(){return h()},$$events:{selectionChange:Ie,categoryChange:te,observationsChange:be},$$slots:{actions:(He,Je)=>{var Xe=sn(),tt=a(Xe);Ue(tt,{variant:"ghost",size:"sm",icon:"⋯","aria-label":"Más opciones",$$events:{click:()=>$e("menu",e(ze))}}),t(Xe),c(He,Xe)}}})}}),t(he),c(L,he)};F(le,L=>{e(de)||L(me)})}t(ve),Z(L=>{pe=Ve(ve,1,"transaction-group svelte-137e8vm",null,pe,L),M(j,`${e(D),d(()=>e(D).transactions.length)??""} transacciones`)},[()=>({collapsed:e(de)})]),c(B,ve)}),t(xe);var E=s(xe,2);{var V=B=>{var D=ln(),de=a(D),De=a(de),ve=s(De);{var pe=H=>{var f=Ze();Z(()=>M(f,`• ${m(l()),d(()=>l().size)??""} seleccionadas`)),c(H,f)};F(ve,H=>{m(h()),m(l()),d(()=>h()&&l().size>0)&&H(pe)})}t(de),t(D),Z(()=>M(De,`Total: ${e(u)??""} transacciones `)),c(B,D)};F(E,B=>{e(u)>0&&B(V)})}c(R,ye)};F(o,R=>{C()?R(_):R(G,!1)},!0)}c(g,O)};F(z,g=>{Y()?g(Q):g(se,!1)})}t(Fe),Z(()=>Ve(Fe,1,Dt(e(I)),"svelte-137e8vm")),c(we,Fe),dt()}var un=p('<div slot="actions"><!> <!></div>'),gn=p('<div slot="extraFilters"><!></div>'),fn=p('<div slot="emptyActions"><!> <!></div>'),hn=p('<div class="fab-container svelte-cp6gid"><!></div>'),mn=p('<div><!> <!> <main class="page-content svelte-cp6gid"><!> <!></main> <!> <!> <!></div>');function pn(we,i){ct(i,!1);const u=ne(),I=ne(),W=ne(),w=ne();let l=y(i,"stats",8),h=y(i,"searchValue",8,""),Y=y(i,"dateRange",8),C=y(i,"dateMode",8,"month"),S=y(i,"filters",24,()=>[]),q=y(i,"transactionGroups",24,()=>[]),fe=y(i,"categories",24,()=>[]),ee=y(i,"selectedTransactions",24,()=>new Set),$=y(i,"selectionMode",8,!1),K=y(i,"showFilters",12,!1),k=y(i,"loading",8,!1),ie=y(i,"currency",8,"EUR"),Ie=y(i,"period",8,"mes actual");const T=At();function te(x){T("headerAction",{action:x})}function be({detail:x}){T("search",x)}function $e({detail:x}){T("dateRangeChange",x)}function qe({detail:x}){T("dateModeChange",x)}function Fe({detail:x}){T("filterChange",x)}function z(){T("filterClear")}function Q({detail:x}){K(x.show),T("toggleFilters",x)}function se(){T("export")}function g(){T("selectAll")}function O(){T("deselectAll")}function o(){T("exitSelection")}function _(){T("bulkCategorize")}function G(){T("bulkDelete")}function R({detail:x}){T("transactionSelection",x)}function ye({detail:x}){T("groupSelection",x)}function xe({detail:x}){T("categoryChange",x)}function E({detail:x}){T("observationsChange",x)}function V({detail:x}){T("transactionAction",x)}function B(){T("addTransaction")}function D(){T("enterSelectionMode")}je(()=>m(ee()),()=>{r(u,ee().size)}),je(()=>m(q()),()=>{r(I,q().reduce((x,j)=>x+j.transactions.length,0))}),je(()=>(m(k()),m(q())),()=>{r(W,!k()&&q().length===0)}),je(()=>(m(k()),m($())),()=>{r(w,["transaction-page-template",k()&&"loading",$()&&"selection-mode"].filter(Boolean).join(" "))}),ut(),gt();var de=mn(),De=a(de);xa(De,{get stats(){return l()},get currency(){return ie()},get period(){return Ie()},get loading(){return k()},$$events:{action:te},children:(x,j)=>{var A=rt(),U=Ge(A);st(U,i,"headerExtra",{},null),c(x,A)},$$slots:{default:!0}});var ve=s(De,2);qa(ve,{get searchValue(){return h()},get dateRange(){return Y()},get dateMode(){return C()},get filters(){return S()},get selectedCount(){return e(u)},get totalCount(){return e(I)},get showFilters(){return K()},get selectionMode(){return $()},get loading(){return k()},$$events:{search:be,dateRangeChange:$e,dateModeChange:qe,filterChange:Fe,filterClear:z,toggleFilters:Q,export:se,selectAll:g,deselectAll:O,exitSelection:o,bulkCategorize:_,bulkDelete:G},$$slots:{actions:(x,j)=>{var A=un(),U=a(A);{var re=Se=>{Ue(Se,{variant:"outline",icon:"☑️",$$events:{click:D},children:(_e,X)=>{We();var ae=Ze("Seleccionar");c(_e,ae)},$$slots:{default:!0}})};F(U,Se=>{!$()&&e(I)>0&&Se(re)})}var Ce=s(U,2);st(Ce,i,"toolbarActions",{},null),t(A),c(x,A)},extraFilters:(x,j)=>{var A=gn(),U=a(A);st(U,i,"extraFilters",{},null),t(A),c(x,A)}}});var pe=s(ve,2),H=a(pe);vn(H,{get groups(){return q()},get categories(){return fe()},get selectedTransactions(){return ee()},get selectionMode(){return $()},get loading(){return k()},get empty(){return e(W)},get currency(){return ie()},$$events:{selectionChange:R,groupSelection:ye,categoryChange:xe,observationsChange:E,transactionAction:V},$$slots:{emptyActions:(x,j)=>{var A=fn(),U=a(A);Ue(U,{variant:"primary",icon:"+",$$events:{click:B},children:(Ce,Se)=>{We();var _e=Ze("Agregar primera transacción");c(Ce,_e)},$$slots:{default:!0}});var re=s(U,2);st(re,i,"emptyActions",{},null),t(A),c(x,A)}}});var f=s(H,2);st(f,i,"content",{},null),t(pe);var P=s(pe,2);{var ue=x=>{var j=hn(),A=a(j);Ue(A,{variant:"primary",size:"lg",icon:"+","aria-label":"Agregar transacción",$$events:{click:B}}),t(j),c(x,j)};F(P,x=>{!$()&&!e(W)&&x(ue)})}var J=s(P,2);st(J,i,"modals",{},null);var ke=s(J,2);st(ke,i,"notifications",{},null),t(de),Z(()=>Ve(de,1,Dt(e(w)),"svelte-cp6gid")),c(we,de),dt()}var _n=p('<span class="error-text svelte-j3v6du"> </span>'),bn=p('<span class="error-text svelte-j3v6du"> </span>'),yn=p('<span class="error-text svelte-j3v6du"> </span>'),wn=p('<button type="button"><span class="category-icon svelte-j3v6du"> </span> <span class="category-name svelte-j3v6du"> </span></button>'),xn=p('<div class="category-grid svelte-j3v6du"></div>'),kn=p('<div class="empty-categories svelte-j3v6du"><div class="empty-categories-content svelte-j3v6du"><span class="empty-categories-icon svelte-j3v6du">🏷️</span> <p class="empty-categories-text svelte-j3v6du">No tienes categorías configuradas. Las categorías te ayudan a organizar y analizar mejor tus gastos e ingresos.</p> <button type="button" class="create-categories-btn svelte-j3v6du"><!> Crear categorías</button></div></div>'),Cn=p('<div class="spinner svelte-j3v6du"></div> ',1),Sn=p('<div class="modal-backdrop svelte-j3v6du" role="dialog" tabindex="-1"><div class="modal-content svelte-j3v6du"><button class="close-btn svelte-j3v6du" aria-label="Close"><!></button> <div class="modal-header svelte-j3v6du"><h3 class="svelte-j3v6du"> </h3></div> <form class="form svelte-j3v6du"><div class="field-group svelte-j3v6du"><div class="amount-container svelte-j3v6du"><div class="amount-input svelte-j3v6du"><span class="currency svelte-j3v6du">€</span> <input type="number" step="0.01" min="0" id="amount" autocomplete="off"/></div> <div class="type-toggle svelte-j3v6du"><button type="button"> </button></div></div> <!></div> <div class="field-group svelte-j3v6du"><label class="field-label svelte-j3v6du" for="merchant"> </label> <input type="text" id="merchant" autocomplete="organization"/> <!></div> <div class="field-group svelte-j3v6du"><label class="field-label svelte-j3v6du" for="description"> </label> <input type="text" class="field-input svelte-j3v6du" id="description" maxlength="200"/></div> <div class="field-group svelte-j3v6du"><label class="field-label svelte-j3v6du" for="date"> </label> <input type="date" id="date"/> <!></div> <div class="field-group svelte-j3v6du"><label class="field-label svelte-j3v6du" for="category"> </label> <!></div> <div class="form-actions svelte-j3v6du"><button type="button" class="btn-secondary svelte-j3v6du"> </button> <button type="submit" class="btn-primary svelte-j3v6du"><!></button></div></form></div></div>');function Dn(we,i){ct(i,!1);const u=()=>Pt(va,"$t",I),[I,W]=ea();let w=y(i,"isOpen",12,!1),l=y(i,"categories",24,()=>[]),h=y(i,"onSubmit",8,()=>{}),Y=y(i,"onCancel",8,()=>{}),C=ne(""),S=ne("expense"),q=ne(""),fe=ne(""),ee=ne(new Date().toISOString().split("T")[0]),$=ne(""),K=ne(!1),k=ne({});function ie(){r(C,""),r(S,"expense"),r(q,""),r(fe,""),r(ee,new Date().toISOString().split("T")[0]),r($,""),r(K,!1),r(k,{})}function Ie(){if(r(k,{}),(!e(C)||isNaN(parseFloat(e(C)))||parseFloat(e(C))<=0)&&qt(k,e(k).amount=u()("transactions.modal.validation.amount_required")),e(q).trim()||qt(k,e(k).merchant=u()("transactions.modal.validation.merchant_required")),!e(ee))qt(k,e(k).date=u()("transactions.modal.validation.date_required"));else{const g=new Date(e(ee)),O=new Date;O.setHours(23,59,59,999),g>O&&qt(k,e(k).date=u()("transactions.modal.validation.future_date"))}return Object.keys(e(k)).length===0}async function T(){if(Ie()){r(K,!0);try{const g=parseFloat(e(C)),o={amount:e(S)==="expense"?-Math.abs(g):Math.abs(g),date:e(ee),time:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),merchant:e(q).trim(),description:e(fe).trim(),categoryId:e($)||void 0,patternHash:void 0,hidden:!1,notes:void 0};await h()(o),te()}catch(g){console.error("Failed to create transaction:",g)}finally{r(K,!1)}}}function te(){w(!1),Y()()}function be(g){g.target===g.currentTarget&&te()}function $e(g){g.key==="Escape"&&te()}function qe(){r(S,e(S)==="expense"?"income":"expense")}function Fe(){te(),sa("/categories")}je(()=>m(w()),()=>{w()&&ie()}),ut(),gt();var z=rt();Te("keydown",Xt,$e);var Q=Ge(z);{var se=g=>{var O=Sn(),o=a(O),_=a(o),G=a(_);Bt(G,{size:20}),t(_);var R=s(_,2),ye=a(R),xe=a(ye,!0);t(ye),t(R);var E=s(R,2),V=a(E),B=a(V),D=a(B),de=s(a(D),2);pt(de);let De;t(D);var ve=s(D,2),pe=a(ve);let H;var f=a(pe,!0);t(pe),t(ve),t(B);var P=s(B,2);{var ue=ce=>{var Me=_n(),Be=a(Me,!0);t(Me),Z(()=>M(Be,(e(k),d(()=>e(k).amount)))),c(ce,Me)};F(P,ce=>{e(k),d(()=>e(k).amount)&&ce(ue)})}t(V);var J=s(V,2),ke=a(J),x=a(ke,!0);t(ke);var j=s(ke,2);pt(j);let A;var U=s(j,2);{var re=ce=>{var Me=bn(),Be=a(Me,!0);t(Me),Z(()=>M(Be,(e(k),d(()=>e(k).merchant)))),c(ce,Me)};F(U,ce=>{e(k),d(()=>e(k).merchant)&&ce(re)})}t(J);var Ce=s(J,2),Se=a(Ce),_e=a(Se,!0);t(Se);var X=s(Se,2);pt(X),t(Ce);var ae=s(Ce,2),oe=a(ae),le=a(oe,!0);t(oe);var me=s(oe,2);pt(me);let L;var he=s(me,2);{var Re=ce=>{var Me=yn(),Be=a(Me,!0);t(Me),Z(()=>M(Be,(e(k),d(()=>e(k).date)))),c(ce,Me)};F(he,ce=>{e(k),d(()=>e(k).date)&&ce(Re)})}t(ae);var ze=s(ae,2),Pe=a(ze),He=a(Pe,!0);t(Pe);var Je=s(Pe,2);{var Xe=ce=>{var Me=xn();et(Me,5,()=>(m(l()),e(S),d(()=>l().filter(Be=>e(S)==="income"&&["income","no_compute"].includes(Be.type)||e(S)==="expense"&&["essential","discretionary","investment","debt_payment","no_compute"].includes(Be.type)))),ot,(Be,Le)=>{var nt=wn();let xt;var yt=a(nt),Tt=a(yt,!0);t(yt);var kt=s(yt,2),Mt=a(kt,!0);t(kt),t(nt),Z(Ct=>{xt=Ve(nt,1,"category-chip svelte-j3v6du",null,xt,Ct),zt(nt,`--category-color: ${e(Le),d(()=>e(Le).color)??""}`),M(Tt,(e(Le),d(()=>e(Le).icon))),M(Mt,(e(Le),d(()=>e(Le).name)))},[()=>({selected:e($)===e(Le).id})]),Te("click",nt,()=>r($,e($)===e(Le).id?"":e(Le).id)),c(Be,nt)}),t(Me),c(ce,Me)},tt=ce=>{var Me=kn(),Be=a(Me),Le=s(a(Be),4),nt=a(Le);na(nt,{size:16}),We(),t(Le),t(Be),t(Me),Te("click",Le,Fe),c(ce,Me)};F(Je,ce=>{m(l()),d(()=>l().length>0)?ce(Xe):ce(tt,!1)})}t(ze);var ft=s(ze,2),Ye=a(ft),Qe=a(Ye,!0);t(Ye);var at=s(Ye,2),_t=a(at);{var vt=ce=>{var Me=Cn(),Be=s(Ge(Me));Z(Le=>M(Be,` ${Le??""}`),[()=>(u(),d(()=>u()("transactions.modal.saving")))]),c(ce,Me)},bt=ce=>{var Me=Ze();Z(Be=>M(Me,Be),[()=>(u(),d(()=>u()("transactions.modal.save_transaction")))]),c(ce,Me)};F(_t,ce=>{e(K)?ce(vt):ce(bt,!1)})}t(at),t(ft),t(E),t(o),t(O),Z((ce,Me,Be,Le,nt,xt,yt,Tt,kt,Mt,Ct,It,Et,jt)=>{M(xe,ce),$t(de,"placeholder",Me),De=Ve(de,1,"amount-field svelte-j3v6du",null,De,Be),H=Ve(pe,1,"type-btn svelte-j3v6du",null,H,Le),M(f,nt),M(x,xt),$t(j,"placeholder",yt),A=Ve(j,1,"field-input svelte-j3v6du",null,A,Tt),M(_e,kt),$t(X,"placeholder",Mt),M(le,Ct),L=Ve(me,1,"field-input date-input svelte-j3v6du",null,L,It),M(He,Et),M(Qe,jt),at.disabled=e(K)},[()=>(u(),d(()=>u()("transactions.modal.new_transaction"))),()=>(u(),d(()=>u()("transactions.modal.amount_placeholder"))),()=>({error:e(k).amount}),()=>({expense:e(S)==="expense",income:e(S)==="income"}),()=>(e(S),u(),d(()=>e(S)==="expense"?u()("transactions.modal.expense"):u()("transactions.modal.income"))),()=>(u(),d(()=>u()("transactions.modal.where_label"))),()=>(u(),d(()=>u()("transactions.modal.merchant_placeholder"))),()=>({error:e(k).merchant}),()=>(u(),d(()=>u()("transactions.modal.what_for_label"))),()=>(u(),d(()=>u()("transactions.modal.description_placeholder"))),()=>(u(),d(()=>u()("transactions.modal.when_label"))),()=>({error:e(k).date}),()=>(u(),d(()=>u()("transactions.category"))),()=>(u(),d(()=>u()("common.cancel")))]),Te("click",_,te),St(de,()=>e(C),ce=>r(C,ce)),Te("click",pe,qe),St(j,()=>e(q),ce=>r(q,ce)),St(X,()=>e(fe),ce=>r(fe,ce)),St(me,()=>e(ee),ce=>r(ee,ce)),Te("click",Ye,te),Te("submit",E,ha(T)),Te("click",O,be),c(g,O)};F(Q,g=>{w()&&g(se)})}c(we,z),dt(),W()}var Tn=p('<div class="future-option svelte-17055o5"><label class="checkbox-option svelte-17055o5"><input type="checkbox" class="svelte-17055o5"/> <span class="checkbox-label svelte-17055o5">Aplicar automáticamente a futuras transacciones similares</span></label></div>'),Mn=p('<label><input type="radio" name="scope" class="svelte-17055o5"/> <div class="option-content svelte-17055o5"><div class="option-info svelte-17055o5"><span class="option-title svelte-17055o5">Transacciones similares</span> <span class="option-detail svelte-17055o5">Aplicar a todas las transacciones similares</span></div> <span class="option-count svelte-17055o5"> </span></div></label> <!>',1),Fn=p('<div class="preview-item svelte-17055o5"><span class="preview-merchant svelte-17055o5"> </span> <span class="preview-amount svelte-17055o5"> </span></div>'),$n=p('<div class="preview-more svelte-17055o5"> </div>'),zn=p('<div class="preview-section svelte-17055o5"><div class="preview-header svelte-17055o5"><span class="preview-title svelte-17055o5">Se aplicará también a:</span> <span class="preview-total svelte-17055o5"> </span></div> <div class="preview-list svelte-17055o5"><!> <!></div></div>'),An=p('<div class="modal-overlay svelte-17055o5" role="dialog" aria-modal="true" aria-labelledby="categorization-title"><div class="modal-content svelte-17055o5"><div class="modal-header svelte-17055o5"><div class="header-content svelte-17055o5"><h2 id="categorization-title" class="modal-title svelte-17055o5">Aplicar categoría</h2> <div class="category-preview svelte-17055o5"><span class="merchant-name svelte-17055o5"> </span> <div class="category-assignment svelte-17055o5"><span class="arrow svelte-17055o5">→</span> <div class="category-chip svelte-17055o5"><span class="category-icon svelte-17055o5"> </span> <span class="category-name svelte-17055o5"> </span></div></div></div></div> <button class="close-btn svelte-17055o5" aria-label="Cerrar"><!></button></div> <div class="content-section svelte-17055o5"><div class="scope-options svelte-17055o5"><label><input type="radio" name="scope" class="svelte-17055o5"/> <div class="option-content svelte-17055o5"><div class="option-info svelte-17055o5"><span class="option-title svelte-17055o5">Solo esta transacción</span> <span class="option-detail svelte-17055o5">Aplicar únicamente a esta transacción</span></div> <span class="option-count svelte-17055o5">1</span></div></label> <!></div> <!></div> <div class="modal-actions svelte-17055o5"><button class="btn-secondary svelte-17055o5">Cancelar</button> <button class="btn-primary svelte-17055o5"> </button></div></div></div>');function In(we,i){ct(i,!1);const u=ne(),I=[];let W=y(i,"isOpen",8,!1),w=y(i,"transaction",8,null),l=y(i,"selectedCategory",8,null),h=y(i,"matchingTransactions",24,()=>[]);y(i,"suggestions",24,()=>[]);let Y=y(i,"onConfirm",8,()=>{}),C=y(i,"onCancel",8,()=>{}),S=ne("single"),q=ne(!1);function fe(){Y()(e(S),e(q))}function ee(T){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(Math.abs(T))}function $(T){return T.merchant||T.description||"Esta transacción"}function K(){const T=h().reduce((te,be)=>te+Math.abs(be.amount),Math.abs(w()?.amount||0));return ee(T)}je(()=>m(h()),()=>{r(u,h().length>0)}),ut(),gt();var k=rt(),ie=Ge(k);{var Ie=T=>{var te=An(),be=a(te),$e=a(be),qe=a($e),Fe=s(a(qe),2),z=a(Fe),Q=a(z,!0);t(z);var se=s(z,2),g=s(a(se),2),O=a(g),o=a(O,!0);t(O);var _=s(O,2),G=a(_,!0);t(_),t(g),t(se),t(Fe),t(qe);var R=s(qe,2),ye=a(R);Bt(ye,{size:20}),t(R),t($e);var xe=s($e,2),E=a(xe),V=a(E);let B;var D=a(V);pt(D),D.value=D.__value="single",We(2),t(V);var de=s(V,2);{var De=J=>{var ke=Mn(),x=Ge(ke);let j;var A=a(x);pt(A),A.value=A.__value="pattern";var U=s(A,2),re=s(a(U),2),Ce=a(re,!0);t(re),t(U),t(x);var Se=s(x,2);{var _e=X=>{var ae=Tn(),oe=a(ae),le=a(oe);pt(le),We(2),t(oe),t(ae),fa(le,()=>e(q),me=>r(q,me)),c(X,ae)};F(Se,X=>{e(S)==="pattern"&&X(_e)})}Z(X=>{j=Ve(x,1,"scope-option svelte-17055o5",null,j,X),M(Ce,(m(h()),d(()=>h().length+1)))},[()=>({selected:e(S)==="pattern"})]),Ut(I,[],A,()=>e(S),X=>r(S,X)),c(J,ke)};F(de,J=>{e(u)&&J(De)})}t(E);var ve=s(E,2);{var pe=J=>{var ke=zn(),x=a(ke),j=s(a(x),2),A=a(j,!0);t(j),t(x);var U=s(x,2),re=a(U);et(re,1,()=>(m(h()),d(()=>h().slice(0,3))),ot,(_e,X)=>{var ae=Fn(),oe=a(ae),le=a(oe,!0);t(oe);var me=s(oe,2),L=a(me,!0);t(me),t(ae),Z(he=>{M(le,(e(X),d(()=>e(X).merchant))),M(L,he)},[()=>(e(X),d(()=>ee(e(X).amount)))]),c(_e,ae)});var Ce=s(re,2);{var Se=_e=>{var X=$n(),ae=a(X);t(X),Z(()=>M(ae,`+${m(h()),d(()=>h().length-3)??""} transacciones más`)),c(_e,X)};F(Ce,_e=>{m(h()),d(()=>h().length>3)&&_e(Se)})}t(U),t(ke),Z(_e=>M(A,_e),[()=>d(K)]),c(J,ke)};F(ve,J=>{e(S),e(u),m(h()),d(()=>e(S)==="pattern"&&e(u)&&h().length>0)&&J(pe)})}t(xe);var H=s(xe,2),f=a(H),P=s(f,2),ue=a(P,!0);t(P),t(H),t(be),t(te),Z((J,ke)=>{M(Q,J),M(o,(m(l()),d(()=>l().icon))),M(G,(m(l()),d(()=>l().name))),B=Ve(V,1,"scope-option svelte-17055o5",null,B,ke),M(ue,(e(S),m(h()),d(()=>e(S)==="single"?"Aplicar categoría":`Aplicar a ${h().length+1}`)))},[()=>(m(w()),d(()=>$(w()))),()=>({selected:e(S)==="single"})]),Te("click",R,function(...J){C()?.apply(this,J)}),Ut(I,[],D,()=>e(S),J=>r(S,J)),Te("click",f,function(...J){C()?.apply(this,J)}),Te("click",P,fe),c(T,te)};F(ie,T=>{W()&&w()&&l()&&T(Ie)})}c(we,k),dt()}var En=p('<div class="uncategorize-section svelte-hnu3u1"><button class="uncategorize-btn svelte-hnu3u1" data-testid="uncategorize-btn"><span class="uncategorize-icon svelte-hnu3u1">❌</span> <span class="uncategorize-text svelte-hnu3u1">Quitar categoría</span></button></div>'),jn=p('<div class="empty-categories svelte-hnu3u1"><div class="empty-categories-content svelte-hnu3u1"><span class="empty-categories-icon svelte-hnu3u1">🏷️</span> <p class="empty-categories-text svelte-hnu3u1">No tienes categorías configuradas. Las categorías te ayudan a organizar y analizar mejor tus gastos e ingresos.</p> <button class="create-categories-btn svelte-hnu3u1"><!> Crear categorías</button></div></div>'),qn=p('<button><span class="category-icon svelte-hnu3u1"> </span> <span class="category-name svelte-hnu3u1"> </span></button>'),On=p('<div class="category-group svelte-hnu3u1"><h3 class="group-title svelte-hnu3u1"> </h3> <div class="category-list svelte-hnu3u1"></div></div>'),Pn=p('<button><span class="category-icon svelte-hnu3u1"> </span> <span class="category-name svelte-hnu3u1"> </span></button>'),Rn=p('<div class="category-group svelte-hnu3u1"><h3 class="group-title svelte-hnu3u1"> </h3> <div class="category-list svelte-hnu3u1"></div></div>'),Bn=p('<div class="modal-overlay svelte-hnu3u1" role="dialog" aria-modal="true" aria-labelledby="category-selection-title" data-testid="category-modal"><div class="modal-content svelte-hnu3u1"><div class="modal-header svelte-hnu3u1"><div class="header-content svelte-hnu3u1"><div class="title-section svelte-hnu3u1"><h2 id="category-selection-title" class="modal-title svelte-hnu3u1">Categorizar</h2> <p class="modal-subtitle svelte-hnu3u1">Selecciona una categoría para organizar esta transacción</p></div> <div class="transaction-preview svelte-hnu3u1"><div class="transaction-info svelte-hnu3u1"><div class="merchant-name svelte-hnu3u1"> </div> <div class="transaction-details svelte-hnu3u1"><span> </span> <span class="separator svelte-hnu3u1">•</span> <span class="date svelte-hnu3u1"> </span></div></div></div></div> <button class="close-btn svelte-hnu3u1" aria-label="Cerrar"><!></button></div> <div class="search-section svelte-hnu3u1"><div class="search-input-container svelte-hnu3u1"><input type="text" placeholder="🔍 Buscar categorías..." class="search-input svelte-hnu3u1"/></div></div> <div class="category-content svelte-hnu3u1"><!> <!></div></div></div>');function Ln(we,i){ct(i,!1);const u=ne(),I=ne(),W=ne();let w=y(i,"isOpen",12,!1),l=y(i,"transaction",8,null),h=y(i,"categories",24,()=>[]),Y=y(i,"onSelect",8,()=>{}),C=y(i,"onCancel",8,()=>{}),S=ne(),q=ne(""),fe=ne();function ee(){typeof document<"u"&&(document.body.style.overflow="hidden")}function $(){typeof document<"u"&&(document.body.style.overflow="")}function K(z){z.target===e(S)&&ie()}function k(z){z.key==="Escape"&&ie()}function ie(){w(!1),C()()}function Ie(z){Y()(z),ie()}function T(){console.log("🔄 Uncategorize button clicked"),Y()(null),ie()}const te={essential:"Gastos Esenciales",discretionary:"Gastos Discrecionales",investment:"Inversiones",debt_payment:"Pago de Deudas",no_compute:"No Computar",income:"Ingresos"};function be(){ie(),sa("/categories")}Zt(()=>{$()}),je(()=>(m(w()),e(fe)),()=>{w()?(ee(),setTimeout(()=>{e(fe)?.focus()},100)):($(),r(q,""))}),je(()=>m(l()),()=>{r(u,l()?l().amount>0:!1)}),je(()=>(m(h()),e(q)),()=>{r(I,h().filter(z=>e(q)===""||z.name.toLowerCase().includes(e(q).toLowerCase())))}),je(()=>(e(u),e(I)),()=>{r(W,e(u)?{income:e(I).filter(z=>z.type==="income"||z.type==="INCOME"),no_compute:e(I).filter(z=>z.type==="no_compute")}:{essential:e(I).filter(z=>z.type==="essential"),discretionary:e(I).filter(z=>z.type==="discretionary"),investment:e(I).filter(z=>z.type==="investment"),debt_payment:e(I).filter(z=>z.type==="debt_payment"),no_compute:e(I).filter(z=>z.type==="no_compute")})}),ut(),gt();var $e=rt();Te("keydown",Xt,k);var qe=Ge($e);{var Fe=z=>{var Q=Bn(),se=a(Q),g=a(se),O=a(g),o=s(a(O),2),_=a(o),G=a(_),R=a(G,!0);t(G);var ye=s(G,2),xe=a(ye);let E;var V=a(xe,!0);t(xe);var B=s(xe,4),D=a(B,!0);t(B),t(ye),t(_),t(o),t(O);var de=s(O,2),De=a(de);Bt(De,{size:18}),t(de),t(g);var ve=s(g,2),pe=a(ve),H=a(pe);pt(H),Qt(H,j=>r(fe,j),()=>e(fe)),t(pe),t(ve);var f=s(ve,2),P=a(f);{var ue=j=>{var A=En(),U=a(A);t(A),Te("click",U,T),c(j,A)};F(P,j=>{m(l()),d(()=>l()?.categoryId)&&j(ue)})}var J=s(P,2);{var ke=j=>{var A=jn(),U=a(A),re=s(a(U),4),Ce=a(re);na(Ce,{size:16}),We(),t(re),t(U),t(A),Te("click",re,be),c(j,A)},x=j=>{var A=rt(),U=Ge(A);{var re=Se=>{var _e=rt(),X=Ge(_e);et(X,1,()=>(e(W),d(()=>Object.entries(e(W)))),ot,(ae,oe)=>{var le=it(()=>Vt(e(oe),2));let me=()=>e(le)[0],L=()=>e(le)[1];var he=rt(),Re=Ge(he);{var ze=Pe=>{var He=On(),Je=a(He),Xe=a(Je,!0);t(Je);var tt=s(Je,2);et(tt,5,L,ot,(ft,Ye)=>{var Qe=qn(),at=a(Qe),_t=a(at,!0);t(at);var vt=s(at,2),bt=a(vt,!0);t(vt),t(Qe),Z(()=>{Ve(Qe,1,`category-option ${me()??""}-type`,"svelte-hnu3u1"),M(_t,(e(Ye),d(()=>e(Ye).icon))),M(bt,(e(Ye),d(()=>e(Ye).name)))}),Te("click",Qe,()=>Ie(e(Ye).id)),c(ft,Qe)}),t(tt),t(He),Z(()=>M(Xe,(me(),d(()=>te[me()])))),c(Pe,He)};F(Re,Pe=>{L(),d(()=>L().length>0)&&Pe(ze)})}c(ae,he)}),c(Se,_e)},Ce=Se=>{var _e=rt(),X=Ge(_e);et(X,1,()=>(e(W),d(()=>Object.entries(e(W)))),ot,(ae,oe)=>{var le=it(()=>Vt(e(oe),2));let me=()=>e(le)[0],L=()=>e(le)[1];var he=rt(),Re=Ge(he);{var ze=Pe=>{var He=Rn(),Je=a(He),Xe=a(Je,!0);t(Je);var tt=s(Je,2);et(tt,5,L,ot,(ft,Ye)=>{var Qe=Pn(),at=a(Qe),_t=a(at,!0);t(at);var vt=s(at,2),bt=a(vt,!0);t(vt),t(Qe),Z(()=>{Ve(Qe,1,`category-option ${me()??""}-type`,"svelte-hnu3u1"),M(_t,(e(Ye),d(()=>e(Ye).icon))),M(bt,(e(Ye),d(()=>e(Ye).name)))}),Te("click",Qe,()=>Ie(e(Ye).id)),c(ft,Qe)}),t(tt),t(He),Z(()=>M(Xe,(me(),d(()=>te[me()])))),c(Pe,He)};F(Re,Pe=>{L(),d(()=>L().length>0)&&Pe(ze)})}c(ae,he)}),c(Se,_e)};F(U,Se=>{e(u)?Se(re):Se(Ce,!1)},!0)}c(j,A)};F(J,j=>{m(h()),d(()=>h().length===0)?j(ke):j(x,!1)})}t(f),t(se),t(Q),Qt(Q,j=>r(S,j),()=>e(S)),Z((j,A)=>{M(R,(m(l()),d(()=>l().merchant))),E=Ve(xe,1,"amount svelte-hnu3u1",null,E,j),M(V,A),M(D,(m(l()),d(()=>l().time)))},[()=>({income:l().amount>0}),()=>(m(l()),d(()=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(Math.abs(l().amount))))]),Te("click",de,ie),St(H,()=>e(q),j=>r(q,j)),Te("click",Q,K),c(z,Q)};F(qe,z=>{w()&&l()&&z(Fe)})}c(we,$e),dt()}function Jt(we){const i=String(we);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i}function Nn(we){return we.toFixed(2)}function Yn(we,i,u={}){let I=[...we];if(u.includeHidden||(I=I.filter(h=>!h.hidden)),u.dateRange){const{start:h,end:Y}=u.dateRange;I=I.filter(C=>C.date>=h&&C.date<=Y)}I.sort((h,Y)=>Y.date.localeCompare(h.date));const W=new Map(i.map(h=>[h.id,h])),l=[["Fecha","Hora","Descripción","Comercio","Categoría","Tipo de Categoría","Importe","Estado"].map(h=>Jt(h)).join(",")];return I.forEach(h=>{const Y=h.categoryId?W.get(h.categoryId):null,C=[h.date,h.time||"",h.description,h.merchant,Y?.name||"",Y?.type||"",Nn(h.amount),h.hidden?"Oculto":"Visible"];l.push(C.map(S=>Jt(S)).join(","))}),l.join(`
`)}function Gn(we,i){const I=new Blob(["\uFEFF"+we],{type:"text/csv;charset=utf-8"}),W=window.URL.createObjectURL(I),w=document.createElement("a");w.href=W,w.download=i,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(W)}function Vn(we){const u=new Date().toISOString().split("T")[0];if(we){const I=we.start.replace(/-/g,""),W=we.end.replace(/-/g,"");return`transacciones_${I}_${W}.csv`}return`transacciones_${u}.csv`}var Hn=p('<div slot="extraFilters"><!> <!></div>'),Un=p('<div slot="toolbarActions"><!></div>'),Wn=p("<!>   <!> <!> <!> <!> <!>",1);function ds(we,i){ct(i,!0);const u=()=>Pt(lt,"$apiTransactions",w),I=()=>Pt(Kt,"$apiCategories",w),W=()=>Pt(Ft,"$apiSelectedTransactions",w),[w,l]=ea();let h=Ae(""),Y=Ae(!1),C=Ae(wt(new Date().toISOString().slice(0,7))),S=Ae(wt([])),q=Ae("all"),fe=Ae(!1),ee=Ae(!1),$=Ae(null),K=Ae(!1),k=Ae(!1),ie=Ae(!1),Ie=Ae(null),T=Ae("month"),te=Ae(""),be=Ae(""),$e=Ae(!1),qe=Ae(!1),Fe=Ae(null),z=Ae(null),Q=Ae(wt([])),se=Ae(wt([])),g=Ae(!1),O=Ae(null),o=Ae(null),_=Ae("");wt(new Set);let G=Ae(wt(typeof window<"u"?localStorage.getItem("showAllTransactions")==="true"||localStorage.getItem("showAllTransactions")===null:!0)),R=Ae(wt(typeof window<"u"?localStorage.getItem("showHiddenTransactions")!=="false":!0));la(()=>{typeof window<"u"&&(localStorage.setItem("showAllTransactions",e(G).toString()),localStorage.setItem("showHiddenTransactions",e(R).toString()))});let ye=it(()=>()=>{let n=u();if(e(G)||(e(T)==="month"&&e(C)?n=n.filter(v=>v.date.startsWith(e(C))):e(T)==="custom"&&e(te)&&e(be)&&(n=n.filter(v=>{const b=new Date(v.date),N=new Date(e(te)),Ee=new Date(e(be));return b>=N&&b<=Ee}))),e(S).length>0?n=n.filter(v=>v.categoryId&&e(S).includes(v.categoryId)):e(q)==="income"?n=n.filter(v=>v.amount>0):e(q)==="expenses"?n=n.filter(v=>v.amount<0):e(q)==="uncategorized"&&(n=n.filter(v=>!v.categoryId)),e(h)){const v=e(h).toLowerCase(),b=parseFloat(e(h)),N=!isNaN(b)&&isFinite(b);n=n.filter(Ee=>{const Ne=Ee.merchant.toLowerCase().includes(v)||Ee.description.toLowerCase().includes(v);let Ke=!1;if(N){const ge=Math.abs(Ee.amount);Ke=Math.abs(ge-b)<.01||ge.toString().includes(b.toString())}return Ne||Ke})}return e(R)||(n=n.filter(v=>!v.hidden)),n.sort((v,b)=>new Date(b.date).getTime()-new Date(v.date).getTime())}),xe=it(()=>()=>{const n=e(ye)(),v=new Map;return n.forEach(b=>{const N=b.date;v.has(N)||v.set(N,[]),v.get(N).push(b)}),Array.from(v.entries()).map(([b,N])=>{const Ee=N.filter(ge=>ge.amount>0).reduce((ge,Oe)=>ge+Oe.amount,0),Ne=N.filter(ge=>ge.amount<0).reduce((ge,Oe)=>ge+Math.abs(Oe.amount),0),Ke=Ee-Ne;return{date:b,transactions:N.sort((ge,Oe)=>new Date(Oe.date).getTime()-new Date(ge.date).getTime()),total:Ke,income:Ee,expenses:Ne}}).sort((b,N)=>new Date(N.date).getTime()-new Date(b.date).getTime())}),E=it(()=>()=>{const v=e(ye)().filter(ge=>!ge.hidden),b=v.filter(ge=>{const Oe=ve(ge.categoryId);return!Oe||Oe.type!=="no_compute"}),N=b.filter(ge=>ge.amount>0).reduce((ge,Oe)=>ge+Oe.amount,0),Ee=Math.abs(b.filter(ge=>ge.amount<0).reduce((ge,Oe)=>ge+Oe.amount,0)),Ne=N-Ee,Ke={essential:0,discretionary:0,investment:0,debt_payment:0,no_compute:0};return b.filter(ge=>ge.amount<0).forEach(ge=>{const Oe=ve(ge.categoryId),ht=Math.abs(ge.amount);if(Oe)switch(Oe.type){case"essential":Ke.essential+=ht;break;case"discretionary":Ke.discretionary+=ht;break;case"investment":Ke.investment+=ht;break;case"debt_payment":Ke.debt_payment+=ht;break;case"no_compute":Ke.no_compute+=ht;break}}),{income:N,expenses:Ee,balance:Ne,transactionCount:v.length,expenseBreakdown:Ke}}),V=it(()=>()=>e(E)()),B=it(()=>()=>{if(e(T)==="custom"&&e(te)&&e(be))return{start:new Date(e(te)),end:new Date(e(be))};if(e(C)){const n=new Date(e(C)+"-01"),v=new Date(n.getFullYear(),n.getMonth(),1),b=new Date(n.getFullYear(),n.getMonth()+1,0);return{start:v,end:b}}return{start:new Date,end:new Date}}),D=it(()=>()=>e(T)==="custom"?"day":"month"),de=it(()=>()=>{const n=[];if(e(q)!=="all"){const v={income:u().filter(b=>b.amount>0).length,expenses:u().filter(b=>b.amount<0).length,uncategorized:u().filter(b=>!b.categoryId).length};n.push({id:e(q),label:e(q)==="income"?"Ingresos":e(q)==="expenses"?"Gastos":"Sin categoría",active:!0,count:v[e(q)],variant:e(q),removable:!0})}return e(S).forEach(v=>{const b=ve(v);b&&n.push({id:v,label:b.name,active:!0,removable:!0})}),n}),De=it(()=>()=>!e(G)&&e(C)?new Date(e(C)+"-01").toLocaleDateString("es-ES",{month:"long",year:"numeric"}):"todos los períodos");function ve(n){if(n)return I().find(v=>v.id===n)}function pe(n){return n?.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim()||""}function H(){if(!e(C)){r(C,new Date().toISOString().slice(0,7),!0);return}const n=new Date(e(C)+"-01");n.setMonth(n.getMonth()-1),r(C,n.toISOString().slice(0,7),!0)}function f(){if(!e(C)){r(C,new Date().toISOString().slice(0,7),!0);return}const n=new Date(e(C)+"-01");n.setMonth(n.getMonth()+1),r(C,n.toISOString().slice(0,7),!0)}function P(){r(C,""),r(G,!0)}function ue(n){Ft.update(v=>{const b=new Set(v);return b.has(n)?b.delete(n):b.add(n),b})}function J(){const n=e(ye)().map(v=>v.id);Ft.set(new Set(n))}function ke(){Ft.set(new Set),r(fe,!1)}async function x(n){try{await lt.add(n),r(K,!1)}catch(v){console.error("Failed to add transaction:",v)}}async function j(n){r(Ie,n,!0),r(ie,!0)}async function A(){e(Ie)&&(await lt.delete(e(Ie)),r(Ie,null),r(ie,!1))}async function U(){r(k,!0)}async function re(){const n=Array.from(W());for(const v of n)await lt.delete(v);ke(),r(k,!1)}async function Ce(n){const v=!n.hidden;try{await lt.update(n.id,{hidden:v})}catch(b){console.error("Failed to toggle hide transaction:",b)}}function Se(n){r($,n,!0),r(ee,!0)}function _e(){r(ee,!1),r($,null)}async function X(n){if(e($))try{!n||n===""?await ae(e($),null):await oe(e($),n),_e()}catch(v){console.error("Failed to handle category selection:",v)}}async function ae(n,v,b=!1){try{const N=window.scrollY;b&&v||await lt.update(n.id,{categoryId:v}),window.scrollTo(0,N)}catch(N){console.error("Failed to categorize transaction:",N)}}async function oe(n,v){try{const b=ve(v);if(!b)return;r(Fe,n,!0),r(z,b,!0);const N=await le(n);r(Q,N,!0);const Ee=me(n,N);r(se,Ee,!0),r(qe,!0)}catch(b){console.error("Failed to initialize smart categorization:",b)}}async function le(n){const v=u()||[],b=[],Ee=pe(n.merchant).split(" ").filter(Ne=>Ne.length>2);for(const Ne of v){if(Ne.id===n.id||Ne.categoryId)continue;const ge=pe(Ne.merchant).split(" ");Ee.filter(ht=>ge.some(Gt=>Gt.includes(ht)||ht.includes(Gt))).length>=Math.min(2,Ee.length)&&b.push(Ne)}return b.slice(0,50)}function me(n,v){if(v.length===0)return[];const N=`Transacciones similares con "${pe(n.merchant)||n.merchant}"`;return[{categoryId:e(z)?.id||"",confidence:Math.min(.95,.7+v.length*.05),reason:N,potentialMatches:v.length}]}async function L(n,v){if(!(!e(Fe)||!e(z)))try{const b=e(Fe),N=e(z).id;if(n==="single")await lt.update(b.id,{categoryId:N});else if(n==="pattern"){const Ee=[b.id,...e(Q).map(Ne=>Ne.id)];await lt.bulkUpdate(Ee,{categoryId:N})}he()}catch(b){console.error("Failed to apply smart categorization:",b)}}function he(){r(qe,!1),r(Fe,null),r(z,null),r(Q,[],!0),r(se,[],!0)}function Re(n){r(o,n.id,!0),r(_,n.observations||"",!0)}async function ze(n){if(e(o)!==n.id)return;const v=e(_).trim()||void 0;try{await lt.update(n.id,{observations:v}),r(o,null),r(_,"")}catch(b){console.error("Failed to save observations:",b)}}function Pe(){r(S,[],!0),r(q,"all")}function He(){let n;if(!e(G))if(e(T)==="month"&&e(C)){const N=new Date(e(C)+"-01"),Ee=new Date(N.getFullYear(),N.getMonth()+1,0);n={start:N.toISOString().split("T")[0],end:Ee.toISOString().split("T")[0]}}else e(T)==="custom"&&e(te)&&e(be)&&(n={start:e(te),end:e(be)});const v=Yn(e(ye)(),I()),b=Vn(n,e(S),I());Gn(v,b)}function Je({detail:n}){switch(n.action){case"previousPeriod":H();break;case"nextPeriod":f();break;case"showAllPeriods":P();break;case"toggleShowAll":r(G,!e(G));break}}function Xe({detail:n}){r(h,n.value,!0)}function tt({detail:n}){r(te,n.dateRange.start.toISOString().split("T")[0],!0),r(be,n.dateRange.end.toISOString().split("T")[0],!0),r(T,"custom")}function ft({detail:n}){n.mode==="month"&&r(T,"month")}function Ye({detail:n}){n.filter.id==="income"||n.filter.id==="expenses"||n.filter.id==="uncategorized"?r(q,n.filter.active?n.filter.id:"all",!0):n.filter.active?r(S,[...e(S),n.filter.id],!0):r(S,e(S).filter(v=>v!==n.filter.id),!0)}function Qe(){Pe()}function at({detail:n}){r(Y,n.show,!0)}function _t(){He()}function vt(){J()}function bt(){ke()}function ce(){ke()}function Me(){}function Be(){U()}function Le({detail:n}){ue(n.transactionId)}function nt({detail:n}){Ft.update(v=>{const b=new Set(v);return n.transactionIds.forEach(N=>{n.selected?b.add(N):b.delete(N)}),b})}function xt({detail:n}){const v=u().find(b=>b.id===n.transactionId);v&&(n.categoryId?oe(v,n.categoryId):ae(v,null))}function yt({detail:n}){const v=u().find(b=>b.id===n.transactionId);v&&(r(o,n.transactionId,!0),r(_,n.observations||"",!0),ze(v))}function Tt({detail:n}){switch(n.action){case"delete":j(n.transaction.id);break;case"hide":Ce(n.transaction);break;case"categorize":Se(n.transaction);break;case"editObservations":Re(n.transaction);break}}function kt(){r(K,!0)}function Mt(){r(fe,!0)}function Ct(n){const v=n.target;e(g)&&!v.closest(".category-selector")&&r(g,!1),e(O)&&!v.closest(".category-selector")&&r(O,null),e($e)&&!v.closest(".date-selector-section")&&r($e,!1)}ca(async()=>{try{await lt.load(),await Kt.load(),document.addEventListener("click",Ct)}catch(n){console.warn("Failed to load transactions or categories on mount:",n)}}),Zt(()=>{document.removeEventListener("click",Ct)});var It=Wn(),Et=Ge(It);{let n=it(()=>e(xe)());pn(Et,{get stats(){return e(V)},get searchValue(){return e(h)},get dateRange(){return e(B)},get dateMode(){return e(D)},get filters(){return e(de)},get transactionGroups(){return e(n)},get categories(){return I()},get selectedTransactions(){return W()},get selectionMode(){return e(fe)},get showFilters(){return e(Y)},loading:!1,currency:"EUR",get period(){return e(De)},$$events:{headerAction:Je,search:Xe,dateRangeChange:tt,dateModeChange:ft,filterChange:Ye,filterClear:Qe,toggleFilters:at,export:_t,selectAll:vt,deselectAll:bt,exitSelection:ce,bulkCategorize:Me,bulkDelete:Be,transactionSelection:Le,groupSelection:nt,categoryChange:xt,observationsChange:yt,transactionAction:Tt,addTransaction:kt,enterSelectionMode:Mt},$$slots:{extraFilters:(v,b)=>{var N=Hn(),Ee=a(N);{var Ne=Oe=>{Ht(Oe,{label:"Período actual",active:!0,removable:!0,$$events:{remove:()=>P()}})};F(Ee,Oe=>{e(G)||Oe(Ne)})}var Ke=s(Ee,2);{var ge=Oe=>{Ht(Oe,{label:"Ocultar archivadas",active:!0,removable:!0,$$events:{remove:()=>r(R,!0)}})};F(Ke,Oe=>{e(R)||Oe(ge)})}t(N),c(v,N)},toolbarActions:(v,b)=>{var N=Un(),Ee=a(N);Ue(Ee,{variant:"outline",icon:"👁️",$$events:{click:()=>r(R,!e(R))},children:(Ne,Ke)=>{We();var ge=Ze();Z(()=>M(ge,e(R)?"Ocultar archivadas":"Mostrar archivadas")),c(Ne,ge)},$$slots:{default:!0}}),t(N),c(v,N)}}})}var jt=s(Et,2);Ln(jt,{get transaction(){return e($)},get categories(){return I()},get show(){return e(ee)},set show(n){r(ee,n,!0)},$$events:{select:({detail:n})=>X(n.categoryId),close:_e}});var Lt=s(jt,2);In(Lt,{get transaction(){return e(Fe)},get category(){return e(z)},get matchingTransactions(){return e(Q)},get suggestions(){return e(se)},get show(){return e(qe)},set show(n){r(qe,n,!0)},$$events:{apply:({detail:n})=>L(n.scope,n.applyToFuture),cancel:he}});var Nt=s(Lt,2);Dn(Nt,{get categories(){return I()},get show(){return e(K)},set show(n){r(K,n,!0)},$$events:{add:({detail:n})=>x(n.transaction),close:()=>r(K,!1)}});var Yt=s(Nt,2);Wt(Yt,{title:"Eliminar transacciones seleccionadas",get message(){return`¿Estás seguro de que deseas eliminar las ${W().size??""} transacciones seleccionadas? Esta acción no se puede deshacer.`},confirmText:"Eliminar",confirmVariant:"danger",get show(){return e(k)},set show(n){r(k,n,!0)},$$events:{confirm:re,cancel:()=>r(k,!1)}});var ra=s(Yt,2);Wt(ra,{title:"Eliminar transacción",message:"¿Estás seguro de que deseas eliminar esta transacción? Esta acción no se puede deshacer.",confirmText:"Eliminar",confirmVariant:"danger",get show(){return e(ie)},set show(n){r(ie,n,!0)},$$events:{confirm:A,cancel:()=>r(ie,!1)}}),c(we,It),dt(),l()}export{ds as component};
